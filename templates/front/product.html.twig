{% extends "front/base.html.twig" %}


{% block main %}

	<h2>{{product.name}}</h2>

	<a href="{{ path("product_like", {'id' : product.id }) }}" class="btn btn-link js-likes">

		{% if app.user and product.isLikeByUser(app.user) %}
			<i class="fas fa-thumbs-up"></i>
		{% else %}
			<i class="far fa-thumbs-up"></i>
		{% endif %}

		<span class="js-likes">{{ product.likes | length }}</span>
		<span class="js-label">J'aime</span>
	</a>

	<a href="#" class="btn btn-link js-dislikes">
		{% if app.user and product.isDislikeByUser(app.user) %}
			<i class="fas fa-thumbs-down"></i>
		{% else %}
			<i class="far fa-thumbs-down"></i>
		{% endif %}

		<span class="js-dislikes">{{ product.dislikes | length }}</span>
		<span class="js-label">Je n'aime pas</span>
	</a>
	<h3>{{product.price}}
		â‚¬</h3>

	<h4>{{product.licence.name}}</h4>
	<h4>{{product.category.name}}</h4>

	{% for media in product.media %}

		<img src="{{ media.src }}" alt="{{ media.alt }}">

	{% endfor %}

	<hr>

	<h3>Commentaires</h3>

	{% for comment in product.comments %}
		<h4>Par
			{{ comment.user.name }}
			{{ comment.user.firstname }}</h4>
		<h5>
			Le
			{{ comment.date | date('d-m-Y') }}</h5>
		<p>{{ comment.content }}</p>

		{% if app.user is same as(comment.user) %}

			<a href="{{path('update_comment', {'id' : comment.id})}}">Modifier le commentaire</a>
			<a href="{{path('delete_comment', {'id' : comment.id})}}">Supprimer le commentaire</a>

		{% endif %}

		<hr>
	{% endfor %}

	{% if app.user %}
		{{form(commentForm)}}
			{% else %}
				<h2>Vous devez vous connecter pour commenter</h2>
		{% endif %}
	{% endblock %}

	{% block js %}

		<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

		<script>

			function onClickLike(event) {
event.preventDefault();

const url = this.href;
const spanCount = this.querySelector('span.js-likes');
const icone = this.querySelector('i');

axios.get(url).then(function (response) {
spanCount.textContent = response.data.likes;
if (icone.classList.contains('fas')) {
icone.classList.replace('fas', 'far')
} else {
icone.classList.replace('far', 'fas')
}
}).catch(function (error) {
if (error.response.status === 403) {
window.alert("Connexion requise");
} else {
window.alert("Une erreur s'est produite")
}
})
}


document.querySelector('a.js-likes').addEventListener('click', onClickLike);
		</script>

	{% endblock %}
